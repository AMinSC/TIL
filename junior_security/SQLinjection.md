### 4.3 SQL 인젝션

- 4.3.0 스토리
    
    2017년 “여기어때”의 고개 정보 및 고객 투숙 정보 노출, 2015년 “뽐뿌”의 개인정보 노출 사고가 SQL injection의 원인
    
- 4.3.1 정의 (원리)
    
    **SQL 인젝션 (SQLi)** 은 공격자가 취약한 SQL 쿼리에 악의적인 입력을 주입하여 데이터베이스에서 임의의 SQL 코드를 실행할 수 있는 공격 기법을 의미합니다. 이러한 취약점은 주로 애플리케이션에서 사용자 입력을 적절히 정제하지 않아 발생하며, 공격자가 데이터베이스에서 실행되는 SQL 쿼리를 조작할 수 있게 됩니다.
    
- 4.3.3 공격 유형
    
    SQLi 공격은 공격자의 목표에 따라 여러 형태를 가질 수 있습니다:
    
    - **클래식 SQLi**: 공격자는 애플리케이션의 입력 필드(검색 상자나 로그인 폼과 같은)에 직접 악의적인 SQL 코드를 입력하여 애플리케이션이 이를 실행하게 합니다.
    - **블라인드 SQLi**: 데이터베이스에서 오류를 표시하지 않지만, 공격자는 애플리케이션의 반응을 관찰함으로써 데이터베이스에 대한 정보를 얻을 수 있습니다.
    - **아웃 오브 밴드 SQLi**: 공격자는 취약점을 악용하여 데이터베이스에 데이터를 외부 서버로 전송하게 합니다.
    - **유니온 기반 SQLi**: 공격자는 원래의 쿼리 결과와 하나 이상의 추가 쿼리 결과를 결합하기 위해 UNION SQL 연산자를 사용합니다.
- 4.3.4 대응 방법
    
    SQLi 취약점이나 공격을 의심하거나 확인한 경우:
    
    - **즉각적인 조치**:
        - 취약한 애플리케이션을 일시적으로 오프라인으로 전환하거나 접근을 제한합니다.
        - 데이터 및 로그를 즉시 백업하여 분석하고 데이터가 조작되는 것을 방지합니다.
        - 공격의 범위를 조사합니다 – 어떤 데이터가 접근되었는지 또는 수정되었는지 확인합니다.
    - **예방**:
        - **입력 유효성 검사**: 항상 사용자 입력을 검사하고 정제하세요.
        - **파라미터화된 쿼리 사용**: 동적으로 SQL 문을 구성하는 대신, 입력을 자동으로 정제하는 플레이스홀더(placeholder)를 사용하여 쿼리를 미리 준비한 뒤, 사용자 입력 값을 바인딩합니다.
        - **ORM (Object-Relational Mapping) 사용**: ORM을 사용하면 입력 정제를 처리하고 파라미터화된 SQL 문을 생성하기 때문에 위험을 줄일 수 있습니다.
        - **저장 프로시저(or 함수) 사용**: 함수나 저장 프로시저 내에서 사용하면 SQL문은 이미 정의되어 있기 때문에 외부 입력으로 인한 쿼리의 구조나 로직을 변경하는 것을 예방합니다. 다만, 저장 프로시저도 위험을 줄일 수 있지만 제대로 작성되지 않으면 여전히 취약할 수 있습니다.
        - **최소 권한 원칙**: 애플리케이션의 데이터베이스 사용자가 필요 최소한의 권한만을 가지도록 합니다. "root"나 "admin" 데이터베이스 계정을 사용하지 마세요. 대신 일반 사용자 계정을 사용하고 필요한 경우에만 관리자 권한을 잠시 부여하는 방식을 사용하는 것이 좋습니다.
        - **웹 애플리케이션 방화벽 (WAF) 사용**: 애플리케이션과 인터넷 사이의 HTTP 트래픽을 필터링하고 모니터링하기 위해 WAF를 사용하는 것을 고려하세요.
            - 웹 애플리케이션 방화벽(Web Application Firewall, WAF): 웹 애플리케이션 방화벽은 웹 애플리케이션에 대한 공격을 탐지하고 차단하는 보안 솔루션입니다.  전통적인 네트워크 방화벽과는 달리, WAF는 HTTP 트래픽을 모니터링하며, 악성 쿼리나 공격 패턴을 탐지하여 차단합니다.
        - **정기적인 업데이트 및 패치**: 모든 소프트웨어와 마찬가지로 데이터베이스 관리 시스템에도 취약점이 있습니다.
    - **사건 발생 후**:
        - 공격 벡터를 파악하기 위해 로그를 분석합니다.
        - 미래의 유사한 시도를 감지하기 위해 방화벽 규칙과 침입 탐지 시스템을 업데이트합니다.
        - 취약점을 제거하기 위해 애플리케이션 코드를 검토하고 업데이트합니다.
    
    SQLi 공격에 대해서는 예방이 핵심입니다. 애플리케이션을 보호하는 데에 적극적이면 사건 발생 후 대응하는 것보다 항상 더 효과적입니다.